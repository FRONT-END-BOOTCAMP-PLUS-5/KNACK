generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String          @id @default(uuid()) @db.Uuid
  name           String          @db.VarChar
  email          String          @unique @db.VarChar
  password       String          @db.VarChar
  deletedAt      DateTime?       @map("deleted_at") @db.Timestamptz(6)
  createdAt      DateTime?       @default(now()) @map("created_at") @db.Timestamptz(6)
  marketing      Boolean         @default(false)
  sns            Boolean         @default(false)
  profileImage   String?         @map("profile_image") @db.VarChar
  point          Int             @default(0)
  isActive       Boolean         @default(true) @map("is_active")
  nickname       String          @db.VarChar
  addresses      Address[]
  carts          Cart[]
  couponMappings CouponMapping[]
  likes          Like[]
  orders         Order[]
  payments       Payment[]
  reviews        Review[]
  userAuths      UserAuth[]

  @@map("users")
}

model UserAuth {
  id           Int    @id @default(autoincrement())
  provider     String @db.VarChar
  providerId   String @unique @map("provider_id") @db.VarChar
  passwordHash String @map("password_hash") @db.VarChar
  userId       String @map("user_id") @db.Uuid
  user         User   @relation(fields: [userId], references: [id])

  @@map("user_auths")
}

model Admin {
  id        Int       @id @default(autoincrement())
  name      String    @db.VarChar
  password  String    @db.VarChar
  role      String?   @default("관리자") @db.VarChar
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  ads       Ad[]
  answers   Answer[]

  @@map("admins")
}

model Ad {
  id           Int       @id @default(autoincrement())
  adminId      Int       @map("admin_id")
  name         String    @db.VarChar
  imgUrl       String    @map("img_url") @db.VarChar
  redirectUrl  String?   @default("/") @map("redirect_url") @db.VarChar
  primary      Int?      @default(0)
  createdAt    DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  isActive     Boolean   @default(false) @map("is_active")
  activateTime DateTime? @map("activate_time") @db.Timestamptz(6)
  price        Int?      @default(0)
  admin        Admin     @relation(fields: [adminId], references: [id])

  @@map("ads")
}

model RelatedProduct {
  productId        Int     @map("product_id")
  relatedProductId Int     @map("related_product_id")
  product          Product @relation("ProductRelated", fields: [productId], references: [id])
  relatedProduct   Product @relation("RelatedToProduct", fields: [relatedProductId], references: [id])

  @@id([productId, relatedProductId])
  @@map("related_products")
}

model Product {
  id                               Int                    @id @default(autoincrement())
  descriptionText                  String?                @map("description_text") @db.VarChar
  thumbnailImage                   String                 @map("thumbnail_image") @db.VarChar
  subImages                        String?                @map("sub_images") @db.VarChar
  price                            Int?                   @default(0)
  discountPercent                  Int?                   @default(0) @map("discount_percent")
  detailContents                   String?                @map("detail_contents") @db.VarChar
  brandId                          Int                    @map("brand_id")
  categoryId                       Int                    @map("category_id")
  isRecommended                    Boolean                @default(false) @map("is_recommended")
  isPrivate                        Boolean                @default(true) @map("is_private")
  createdAt                        DateTime?              @default(now()) @map("created_at") @db.Timestamptz(6)
  gender                           String?                @default("all") @db.VarChar
  hit                              Int?                   @default(0)
  engName                          String                 @map("eng_name") @db.VarChar
  korName                          String                 @map("kor_name") @db.VarChar
  subCategoryId                    Int                    @map("sub_category_id")
  modelNumber                      Int?                   @map("model_number")
  releaseDate                      DateTime?              @map("release_date") @db.Timestamptz(6)
  colorKorName                     String                 @map("color_kor_name") @db.VarChar
  colorEngName                     String                 @map("color_eng_name") @db.VarChar

  coupons                          Coupon[]
  inquires                         Inquiry[]
  likes                            Like[]
  orders                           Order[]
  productOptionMappings            ProductOptionMapping[]
  brand                            Brand                  @relation(fields: [brandId], references: [id])
  category                         Category               @relation(fields: [categoryId], references: [id])
  relatedProducts_ProductRelated   RelatedProduct[]       @relation("ProductRelated")
  relatedProducts_RelatedToProduct RelatedProduct[]       @relation("RelatedToProduct")
  reviews                          Review[]
  carts                            Cart[]
  subCategory                      SubCategory            @relation(fields: [subCategoryId], references: [id])
  productStockMapping              ProductStockMapping[]

  @@map("products")
}

model ProductStockMapping {
  id             Int             @id @default(autoincrement())
  productId      Int             @map("product_id")
  stock          Int             @default(0)
  optionTypeId   Int             @map("option_type_id")
  optionValueId  Int             @map("option_value_id")

  product        Product         @relation(fields: [productId], references: [id])
  optionType     OptionType      @relation(fields: [optionTypeId], references: [id])
  optionValue    OptionValue     @relation(fields: [optionValueId], references: [id])

  @@map("product_stock_mappings")
}


model Coupon {
  id             Int             @id @default(autoincrement())
  name           String          @db.VarChar
  salePercent    Int?            @default(0) @map("sale_percent")
  productId      Int             @map("product_id")
  createdAt      DateTime?       @default(now()) @map("created_at") @db.Timestamptz(6)
  expirationAt   DateTime?       @map("expriation_at") @db.Timestamptz(6)
  couponMappings CouponMapping[]
  product        Product         @relation(fields: [productId], references: [id])

  @@map("coupons")
}

model CouponMapping {
  id        Int       @id @default(autoincrement())
  userId    String    @map("user_id") @db.Uuid
  couponId  Int       @map("coupon_id")
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  coupon    Coupon    @relation(fields: [couponId], references: [id])
  user      User      @relation(fields: [userId], references: [id])

  @@map("coupon_mappings")
}

model Answer {
  inquiryId Int       @map("inquiry_id")
  adminId   Int       @map("admin_id")
  contents  String    @db.VarChar
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  admin     Admin     @relation(fields: [adminId], references: [id])
  inquiry   Inquiry   @relation(fields: [inquiryId], references: [id])

  @@id([inquiryId, adminId])
  @@map("answers")
}

model Inquiry {
  id        Int       @id @default(autoincrement())
  productId Int       @map("product_id")
  contents  String    @db.VarChar
  isPrivate Boolean   @default(false) @map("is_private")
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  answers   Answer[]
  product   Product   @relation(fields: [productId], references: [id])

  @@map("inquires")
}

model Review {
  userId       String    @map("user_id") @db.Uuid
  productId    Int       @map("product_id")
  contents     String    @db.VarChar
  rating       Int?      @default(0)
  reviewImages String?   @map("review_images") @db.VarChar
  createdAt    DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  product      Product   @relation(fields: [productId], references: [id])
  user         User      @relation(fields: [userId], references: [id])

  @@id([userId, productId])
  @@map("reviews")
}

model OptionType {
  id                    Int                    @id @default(autoincrement())
  name                  String                 @db.VarChar
  isPrivate             Boolean                @default(true) @map("is_private")
  productOptionMappings ProductOptionMapping[]
  optionValue           OptionValue[]         
  productStockMapping   ProductStockMapping[]

  @@map("option_types")
}

model OptionValue {
  id                    Int          @id @default(autoincrement())
  isPrivate             Boolean      @default(true) @map("is_private")
  name                  String       @db.VarChar
  typeId                Int          @map("type_id")
  optionTypes           OptionType @relation(fields: [typeId], references: [id])
  cart                  Cart[]
  productStockMapping   ProductStockMapping[]

  @@map("option_values")
}

model ProductOptionMapping {
  id            Int         @id @default(autoincrement())
  productId     Int         @map("product_id")
  optionTypeId  Int         @map("option_type_id")
  
  optionType    OptionType  @relation(fields: [optionTypeId], references: [id])
  product       Product     @relation(fields: [productId], references: [id])

  @@map("product_option_mappings")
}

model Brand {
  id        Int       @id @default(autoincrement())
  korName   String    @map("kor_name") @db.VarChar
  engName   String    @map("eng_name") @db.VarChar
  logoImage String    @map("logo_image") @db.VarChar
  isPrivate Boolean   @default(true) @map("is_private")
  products  Product[]

  @@map("brands")
}

model Category {
  id            Int           @id @default(autoincrement())
  createdAt     DateTime?     @default(now()) @map("created_at") @db.Timestamptz(6)
  isPrivate     Boolean       @default(true) @map("is_private")
  engName       String        @map("eng_name") @db.VarChar
  korName       String        @map("kor_name") @db.VarChar
  products      Product[]
  subCategories SubCategory[]

  @@map("categories")
}

model SubCategory {
  id         Int       @id @default(autoincrement())
  engName    String    @map("eng_name") @db.VarChar
  korName    String    @map("kor_name") @db.VarChar
  categoryId Int       @map("category_id")
  createdAt  DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  isPrivate  Boolean   @default(true) @map("is_private")
  category   Category  @relation(fields: [categoryId], references: [id])
  products   Product[]

  @@map("sub_categories")
}

model Like {
  id        Int       @id @default(autoincrement())
  userId    String    @map("user_id") @db.Uuid
  productId Int       @map("product_id")
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  product   Product   @relation(fields: [productId], references: [id])
  user      User      @relation(fields: [userId], references: [id])

  @@map("likes")
}

model Order {
  id             Int       @id @default(autoincrement())
  userId         String    @map("user_id") @db.Uuid
  productId      Int       @map("product_id")
  price          Int?      @default(0)
  salePrice      Int?      @default(0) @map("sale_price")
  tracking       String?   @db.VarChar
  createdAt      DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  deliveryStatus Int?      @map("delivery_status")
  count          Int?      @default(0)
  paymentId      Int?       @map("payment_id")
  payment        Payment?   @relation(fields: [paymentId], references: [id])
  product        Product   @relation(fields: [productId], references: [id])
  user           User      @relation(fields: [userId], references: [id])

  @@map("orders")
}

model Payment {
  id             Int       @id @default(autoincrement())
  userId         String    @map("user_id") @db.Uuid
  price          Int?      @default(0)
  createdAt      DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  paymentNumber  BigInt       @map("payment_number")
  addressId      Int       @map("address_id")
  approvedAt     DateTime? @map("approved_at") @db.Timestamptz(6)
  method         String    @db.VarChar
  status         String    @db.VarChar
  tossPaymentKey String    @unique @map("toss_payment_key") @db.VarChar
  orders         Order[]
  address        Address   @relation(fields: [addressId], references: [id])
  user           User      @relation(fields: [userId], references: [id])

  @@map("payments")
}

model Address {
  id        Int       @id @default(autoincrement())
  userId    String    @map("user_id") @db.Uuid
  name      String    @db.VarChar
  phone     String?   @db.VarChar
  zipCode   String    @map("zip_code") @db.VarChar
  detail    String?   @db.VarChar
  main      String    @db.VarChar
  message   String?   @db.VarChar
  isDefault Boolean   @default(false) @map("is_default")
  user      User      @relation(fields: [userId], references: [id])
  payments  Payment[]

  @@map("addresses")
}

model Cart {
  id                   Int                  @id @default(autoincrement())
  userId               String               @map("user_id") @db.Uuid
  productId            Int                  @map("product_id")
  createdAt            DateTime?            @default(now()) @map("created_at") @db.Timestamptz(6)
  count                Int?                 @default(1)
  optionValueId        Int                  @map("option_value_id")
  user                 User                 @relation(fields: [userId], references: [id])
  product              Product              @relation(fields: [productId], references: [id])
  optionValue          OptionValue        @relation(fields: [optionValueId], references: [id])

  @@map("carts")
}